import 'package:test_api/test_api.dart';
import 'package:the_boring_flutter_dev_show/src/article.dart';
import 'package:http/http.dart' as http;

void main() {
  test('parses topstories.json', () {
    final String jsonString = '[19712057,19711756,19712151,19711531,19712013,19711257,19710288,19710398,19712058,19709835,19709318,19711241,19711141,19703488,19710316,19710835,19707404,19699053,19711567,19712167,19710747,19711851,19708982,19710841,19708620,19709551,19711732,19703745,19701279,19709811,19705741,19708997,19708778,19710972,19709475,19708429,19709411,19706514,19708742,19707570,19698674,19697217,19708451,19705658,19707426,19704792,19707660,19707516,19710902,19698823,19705561,19701767,19710805,19710770,19689039,19707686,19705432,19707167,19705616,19706396,19705440,19705622,19701416,19708870,19710021,19705511,19710412,19707174,19709289,19697122,19698827,19707814,19704418,19700624,19706330,19707543,19689319,19704507,19695595,19704838,19698036,19711215,19704067,19705185,19698525,19698598,19702266,19704448,19711296,19687398,19707248,19698399,19690575,19696183,19699070,19699792,19707127,19692418,19699031,19704486,19698834,19688460,19702000,19710019,19689946,19702965,19690170,19708789,19703665,19701783,19708102,19695114,19706560,19707805,19698358,19698107,19711119,19706777,19702803,19701288,19708133,19703075,19692820,19690438,19690260,19696968,19709812,19704347,19703909,19696096,19710370,19691407,19707723,19706559,19689571,19709900,19698696,19698507,19703437,19706409,19694578,19690812,19688491,19686622,19690010,19705124,19697848,19702603,19701127,19709801,19703674,19705954,19706834,19700204,19708837,19686972,19710357,19692224,19690449,19709784,19704178,19702128,19687549,19704179,19698727,19704939,19692451,19709699,19701175,19707071,19704205,19690447,19689601,19702145,19696604,19705461,19698908,19694006,19699288,19694077,19689910,19700698,19698363,19694207,19701008,19690969,19709358,19705064,19698151,19694027,19708302,19710121,19687447,19690382,19698003,19699754,19696026,19700803,19695255,19709483,19695347,19693650,19707853,19709915,19693434,19689341,19694281,19685516,19699396,19686578,19706120,19700784,19688258,19706454,19690646,19694356,19708596,19696717,19691304,19703772,19697823,19707200,19689329,19707993,19703613,19707571,19694091,19709507,19697405,19706440,19708879,19693726,19689995,19690152,19710005,19704233,19691000,19692223,19709168,19695425,19690588,19692214,19688233,19698991,19690137,19689554,19686860,19705778,19697072,19690167,19686411,19693321,19693624,19695264,19691621,19689891,19705285,19685405,19686096,19689859,19707709,19696286,19689997,19689996,19704735,19702302,19704653,19691426,19690138,19705013,19700181,19688039,19701493,19687029,19691984,19689396,19697145,19690688,19697338,19698235,19694377,19706480,19690313,19693099,19692343,19685431,19686701,19686492,19708526,19694793,19702368,19687483,19691055,19701648,19704590,19701325,19688955,19686832,19685532,19689941,19700681,19700583,19707863,19705599,19699850,19694569,19707659,19707620,19685317,19706287,19699116,19691691,19699130,19706013,19692674,19705938,19704148,19705914,19698464,19691497,19698295,19691153,19698067,19695165,19702040,19690333,19694756,19700497,19696438,19703146,19697647,19702872,19693672,19689519,19705299,19705295,19700757,19702232,19691294,19700566,19704795,19710935,19701806,19691562,19704384,19701451,19685396,19705990,19696486,19701832,19702543,19703923,19695615,19693679,19703718,19695292,19706243,19689612,19687044,19701475,19686332,19701394,19693233,19686549,19701157,19685712,19693640,19693145,19700806,19686380,19696324,19705396,19693919,19692164,19693381,19699303,19702374,19688336,19704170,19695662,19702968,19699659,19691522,19688275,19703942,19699327,19699221,19694750,19686999,19695897,19703671,19686364,19696639,19693927,19695273,19685676,19704820,19700210,19690854,19685275,19688564,19691722,19695080,19688816,19701657,19688721,19694602,19693891,19701232,19699299,19687237,19687593,19688485,19688007,19700662,19700452,19692845,19703952,19700437,19686745,19700317,19687092,19687016,19686990,19686868,19686857,19685272,19686386,19686781,19694703,19686587,19693377,19695616,19697287,19704869,19700334,19702335,19693520,19694410,19696445,19701704,19696248,19701282,19700154,19688782,19697779,19700984,19700965,19688548,19691994,19692895,19695354,19686624,19694187,19690397,19693501,19696408,19698778,19700945,19687966,19698423,19689356,19691375,19695364,19695346,19694404,19701461,19688175,19689899,19688079,19697562,19697179,19685465,19689203,19689854,19696903,19691456,19685800,19685578,19691014,19690722,19688340,19695648,19689930,19687110,19686973,19695245,19686465,19689499,19698620,19694579,19694438,19687162,19688601,19692665,19692477,19685352,19692137,19691972,19691856]';

    expect(parseJsonString(jsonString).first, 19712057);
  });

  test('parses article', () {
    const String jsonIdData = '''{"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8917,8952,8884,8887,8869,8958,8940,8908,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"} ''';

    expect(parseArticle(jsonIdData).by, 'dhouston');
  });

  test('parses article over the network', () async{
    final url = 'https://hacker-news.firebaseio.com/v0/beststories.json';
    final response = await http.get(url);
    if(response.statusCode == 200) {
      final idList = parseJsonString(response.body);
      if(idList.isNotEmpty) {
        final storyUrl = 'https://hacker-news.firebaseio.com/v0/item/${idList.first}.json';
        final storyResponse = await http.get(storyUrl);
        if(storyResponse.statusCode == 200) {
          expect(parseArticle(storyResponse.body).by, 'xvextor');
        }
      }
    }
  }, skip: true);
}